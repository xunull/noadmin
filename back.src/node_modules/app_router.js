var express = require('express');
var home = require('./controllers/home');
var menu_router = require('./router/menu_router');
var setting_router = require('./router/setting_router');
var apiRouter = require('./router').apiRouter;
var adminRouter = require('./router').adminRouter;
var defaultRouter = require('./router').defaultRouter;
var middlewares = require('./middlewares');
var express_app = global.thisapp.express_app;
var config = global.thisapp.config;

// 中间件添加的顺序就是中间件执行的顺序
// 解析debug 参数
if (config.debug) {
    express_app.use(middlewares.debug.parse);
}
// nosession
express_app.use(middlewares.nosession.setSession);
// 权限验证中间件
// 先执行对权限的验证
express_app.use(middlewares.permission.userRequired);

express_app.use(middlewares.menu.generateUserMenu);

express_app.use(middlewares.resEnhance.addReply);

// 这个router 内 包含 用户登陆，登出 这些
express_app.use('/', defaultRouter);

//**************************** 系统设置 ********************************
// 有关菜单操作的路由
express_app.use('/menu', menu_router);
// 设置项相关的路由
express_app.use('/setting', setting_router);

express_app.use('/api', apiRouter);
express_app.use('/admin',adminRouter);
